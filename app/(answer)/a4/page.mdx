import Counter from "@/components/posts/4/Counter";

## ì •ë‹µ: `age`ì™€ `name`ì˜ ê°’ì˜ ìœ„ì¹˜ê°€ êµí™˜ëœë‹¤.

<Counter />

### í›…ì˜ ê·œì¹™: ë°˜ë³µë¬¸, ì¡°ê±´ë¬¸, ë˜ëŠ” ì¤‘ì²©ëœ í•¨ìˆ˜ ì•ˆì—ì„œ í›…ì„ í˜¸ì¶œí•´ì„œëŠ” ì•ˆëœë‹¤.

---

ì§ì ‘ `useState`ë¥¼ êµ¬í˜„í•˜ë©´ì„œ ìœ„ì˜ ê·œì¹™ì´ ë¬´ì—‡ì„ ì˜ë¯¸í•˜ëŠ”ì§€ ì•Œì•„ë³´ì.

`useState` í›… êµ¬í˜„ì˜ í•µì‹¬ì€ ë Œë”ë§ ì‚¬ì´ì—ì„œ ìƒíƒœê°’ì´ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•„ì•¼ í•œë‹¤ëŠ” ê²ƒì´ë‹¤. ë§Œì•½ `useState`ë¥¼ ì•„ë˜ì™€ ê°™ì´ êµ¬í˜„í•œë‹¤ë©´, ìƒˆë¡œìš´ ë Œë”ë§ì´ ì§„í–‰ë˜ì–´ `useState`ë¥¼ í˜¸ì¶œí•  ë•Œë§ˆë‹¤ ê°’ì´ ì´ˆê¸°í™”ë  ê²ƒì´ë‹¤.

```js showLineNumbers
function useState(initialState) {
  let _state = initialState;

  function setState(newState) {
    _state = newState;
  }
  return [_state, setState];
}
```

ì´ ë¬¸ì œë¥¼ ì–´ë–»ê²Œ í•´ê²°í•  ìˆ˜ ìˆì„ê¹Œ? ë‹µì€ í´ë¡œì €ì— ìˆë‹¤.

```js showLineNumbers title="closureExample.js"
function Counter() {
  let counter = 0;

  function getValue() {
    return counter;
  }

  function increase() {
    counter += 1;
  }

  return { getValue, increase };
}

let counter = Counter();
counter.increase();
counter.increase();
counter.getValue(); // 2
```

í´ë¡œì €ëŠ” ì„ ì–¸ë  ë‹¹ì‹œì˜ ì£¼ë³€ í™˜ê²½ì„ ê¸°ì–µí–ˆë‹¤ê°€ ì´í›„ì—ë„ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” í•¨ìˆ˜ì´ë‹¤. í´ë¡œì € ì•ˆì˜ ë³€ìˆ˜ëŠ” ë§ˆì¹˜ "ì£½ì§€ ì•ŠëŠ” ë³€ìˆ˜"ì™€ ê°™ë‹¤. í•¨ìˆ˜ `Counter()`ì˜ ì‹¤í–‰ì´ ëë‚˜ë”ë¼ë„ ë³€ìˆ˜ `counter`ëŠ” ì‚¬ë¼ì§€ì§€ ì•ŠëŠ”ë‹¤. ë”°ë¼ì„œ ì´í›„ì— `increase()`, `getValue()` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí–ˆì„ ë•Œë„ ì˜ˆìƒëŒ€ë¡œ ì˜¬ë°”ë¥´ê²Œ ë™ì‘í•  ìˆ˜ ìˆëŠ” ê²ƒì´ë‹¤.

í´ë¡œì €ë¥¼ í™œìš©í•˜ì—¬ `useState`ì˜ ì½”ë“œë¥¼ ê°„ë‹¨í•˜ê²Œ ì‘ì„±í•´ë³´ë©´ ì•„ë˜ì™€ ê°™ë‹¤.

```js showLineNumbers title="src/core/React.js"
function React() {
  let _state;

  function render() {
    /*...*/
  }

  function useState(initialState) {
    _state = _state || initialState;
    function setState(newState) {
      _state = newState;
      render();
    }
    return [_state, setState];
  }

  return { useState };
}
```

```js showLineNumbers title="src/App.jsx" "// prettier-ignore"#hidden
const { useState, render } = React();
// prettier-ignore
function App() {
  const [count, setCount] = useState(0);

  return (
    <div>
      <p> you clicked {count} times </p>
      <button onClick={() => { setCount(count + 1); }}> increase count </button>
    </div>
  );
}
```

ìœ„ ì½”ë“œì˜ ì‘ë™ì€ êµ¬ì²´ì ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ë‹¤.

1. ì»´í¬ë„ŒíŠ¸ê°€ ì²˜ìŒ ë§ˆìš´íŠ¸ ë  ë•Œ

   - `App`ì€ `0`ì„ ë§¤ê°œë³€ìˆ˜ë¡œ í•˜ì—¬ `useState`ë¥¼ í˜¸ì¶œí•œë‹¤.
   - ë§¨ ì²˜ìŒì— ë³€ìˆ˜ `_state`ëŠ” `undefined`ì´ë‹¤. ë”°ë¼ì„œ `_state`ì€ ì „ë‹¬ëœ ê°’ `0`ìœ¼ë¡œ ì´ˆê¸°í™”ëœë‹¤.
   - `useState`ëŠ” ìƒíƒœê°’ `_state`ì™€ setter í•¨ìˆ˜ `setState`ë¥¼ ë°˜í™˜í•œë‹¤.

2. `setState`ê°€ í˜¸ì¶œë˜ì—ˆì„ ë•Œ

   - ë‚´ë¶€ ë³€ìˆ˜ `_state`ì˜ ê°’ì„ `1`ë¡œ ìˆ˜ì •í•œë‹¤.
   - í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ì˜ ë¦¬ë Œë”ë§ì„ ë°œìƒì‹œí‚¨ë‹¤.

3. ë¦¬ë Œë”ë§ì´ ë°œìƒë˜ì—ˆì„ ë•Œ
   - `App`ì€ `0`ì„ ë§¤ê°œë³€ìˆ˜ë¡œ í•˜ì—¬ ë‹¤ì‹œ `useState`ë¥¼ í˜¸ì¶œí•œë‹¤.
   - ì´ë²ˆì—ëŠ” `_state`ê°€ `undefined`ê°€ ì•„ë‹ˆë¯€ë¡œ ì „ë‹¬ëœ ê°’ `0`ì€ ë¬´ì‹œë˜ê³ , `_state`ëŠ” ì—¬ì „íˆ `1`ì´ë‹¤.
   - `useState`ëŠ” ìƒíƒœê°’ `_state`ì™€ setter í•¨ìˆ˜ `setState`ë¥¼ ë°˜í™˜í•œë‹¤.

ì´ì œ ìƒíƒœê°€ ì—¬ëŸ¬ê°œì¸ ê²½ìš°ë¥¼ êµ¬í˜„í•´ë³´ì. ë³µì¡í•˜ê²Œ ìƒê°í•  í•„ìš” ì—†ì´, ë°°ì—´ê³¼ ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‰½ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.

```js showLineNumbers title="src/core/React.js"
function React() {
  let _states = [];
  let cursor = 0;

  function render() {
    /*...*/
    cursor = 0;
  }

  function useState(initialState) {
    if (_states.length === cursor) _states.push(initialState);

    const state = _states[cursor];
    function setState(newState) {
      _states[cursor] = newState;
      render();
    }

    cursor += 1;
    return [state, setState];
  }

  return { useState };
}
```

```js showLineNumbers title="src/App.jsx" "// prettier-ignore"#hidden
const { useState, render } = React();
// prettier-ignore
function App() {
  const [count, setCount] = useState(0);
  const [name, setName] = useState("John");

  return (
    <div>
      <p> you clicked {count} times </p>
      <button onClick={() => { setCount(count + 1); }}> increase count </button>
      <p> your name is {name} </p>
      <button onClick={() => { setName("David"); }}> change name </button>
    </div>
  );
}
```

ì»´í¬ë„ŒíŠ¸ ë‚´ì—ì„œ `useState`ê°€ í•œë²ˆ ë“±ì¥í•  ë•Œë§ˆë‹¤ `cursor`ê°€ 1ì”© ì¦ê°€í•˜ë©´ì„œ ë°°ì—´ì˜ ìƒˆë¡œìš´ ì¹¸ì— ìƒíƒœë¥¼ ì •ì˜í•˜ëŠ” ì‹ìœ¼ë¡œ êµ¬í˜„í–ˆë‹¤. ë Œë”ë§ì´ ëë‚œ ë’¤ì—ëŠ” ë‹¤ì‹œ `cursor`ë¥¼ `0`ìœ¼ë¡œ ì´ˆê¸°í™” í•´ì£¼ì–´ ì»´í¬ë„ŒíŠ¸ê°€ ë‹¤ì‹œ í˜¸ì¶œë˜ì—ˆì„ ë•Œ ë°°ì—´ `_states`ë¥¼ ì²« ë²ˆì§¸ ì¹¸ë¶€í„° ì½ì„ ìˆ˜ ìˆë„ë¡ í•œë‹¤.

ì´ì œ ë¬¸ì œì˜ ì½”ë“œë¥¼ ë‹¤ì‹œ ì½ì–´ë³´ì.

```js showLineNumbers
function App() {
  const [ageFirst, setAgeFirst] = useState(true);

  let age, setAge, name, setName;

  if (ageFirst) {
    [age, setAge] = useState(20);
    [name, setName] = useState("John");
  } else {
    [name, setName] = useState("John");
    [age, setAge] = useState(20);
  }

  return (
    //...
  );
}
```

ì²« ë²ˆì§¸ ë Œë”ë§ì—ì„œëŠ” `_states`ì˜ 0ë²ˆì§¸ ì¹¸ì— `true`ê°€ ë“¤ì–´ê°„ë‹¤. ë˜í•œ `ageFirst`ê°€ `true`ì´ë¯€ë¡œ, `_states`ì˜ 1ë²ˆì§¸ ì¹¸ì— `20`, 2ë²ˆì§¸ ì¹¸ì— `John`ì´ ë“¤ì–´ê°„ë‹¤. ë˜í•œ ë³€ìˆ˜ `age`ì™€ `name`ì—ëŠ” `useState`ì—ì„œ ë°˜í™˜ëœ ê°’ì¸ `20`, `John`ì´ ê°ê° ë“¤ì–´ê°„ë‹¤.

ë°˜ë©´ `boyFirst`ê°€ `false`ë¡œ ë°”ë€Œê³  ë‚œ ë’¤ì—ëŠ” ì´ì•¼ê¸°ê°€ ë‹¬ë¼ì§„ë‹¤. `ageFirst`ê°€ `_states`ì˜ 0ë²ˆì§¸ ì¹¸ì—ì„œ ìƒíƒœê°’ì„ ë°›ëŠ” ê²ƒì€ ë¬¸ì œê°€ ì—†ì§€ë§Œ, ì´ë²ˆì—ëŠ” `name`ì— `_state[1]`ì˜ ê°’ì¸ `20`ì´ ë“¤ì–´ê°€ê³ , `age`ì— `_state[2]`ì˜ ê°’ì¸ `John`ì´ ë“¤ì–´ê°„ë‹¤. ì—¬ê¸°ì„œ `useState`ì˜ ì¸ìëŠ” ì•„ë¬´ëŸ° ì˜í–¥ë„ ë¼ì¹˜ì§€ ì•ŠëŠ”ë‹¤.

> í›…ì˜ ê·œì¹™: ë°˜ë³µë¬¸, ì¡°ê±´ë¬¸, ë˜ëŠ” ì¤‘ì²©ëœ í•¨ìˆ˜ ì•ˆì—ì„œ í›…ì„ í˜¸ì¶œí•´ì„œëŠ” ì•ˆëœë‹¤.

ì´ì œ ìœ„ì˜ ê·œì¹™ì´ ë¬´ì—‡ì„ ì˜ë¯¸í•˜ëŠ”ì§€ ì•Œ ìˆ˜ ìˆë‹¤. `React`ëŠ” ê·¸ì € í›…ì´ ë“±ì¥í•˜ëŠ” ìˆœì„œëŒ€ë¡œ ë¦¬ìŠ¤íŠ¸ì—ì„œ ê°’ì„ ì°¾ì•„ ì „ë‹¬í•´ì£¼ëŠ” ì—­í• ì„ í•  ë¿ì´ë‹¤. ë³€ìˆ˜ëª…ì´ `age`ì¸ì§€ `name`ì¸ì§€ëŠ” ì „í˜€ ì¤‘ìš”í•˜ì§€ ì•Šë‹¤. í›…ì´ ì‹¤í–‰ë˜ëŠ” ìˆœì„œê°€ í•­ìƒ ì¼ì •í•˜ê²Œ ìœ ì§€ë˜ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ê³ , ìœ„ì˜ ê·œì¹™ì€ ìˆœì„œê°€ ë°”ë€Œì§€ ì•Šê¸° ìœ„í•œ í•„ìš”ì¡°ê±´ ì¤‘ í•˜ë‚˜ë¥¼ ì œì‹œí•œ ê²ƒì´ë‹¤.

---

### ì°¸ê³ ìë£Œ

- https://medium.com/@ryardley/react-hooks-not-magic-just-arrays-cd4f1857236e

- `ğŸ‡°ğŸ‡·` https://junilhwang.github.io/TIL/Javascript/Design/Vanilla-JS-Make-useSate-hook/

- `ğŸ‡°ğŸ‡·` https://d5br5.dev/blog/deep_dive/react_useState_understanding
